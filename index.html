<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promoter Self-Discovery Diagnostic</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel for running React in the browser -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@0.344.0/dist/umd/lucide.min.js"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 10px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-[#F8FAFC]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Configuration
        const apiKey = ""; 
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbTuT3cgeNjEKVl39ek-RpDeTxBWfpmditY5C6GHitz-bEU_APGi6gxW8KBD53rSIXyKA/exec"; 
        // UPDATED: Your live GitHub URL
        const APP_URL = "https://dhananjaywalke-prog.github.io/my-management-style/"; 

        // Fixed Icons implementation using Lucide createSvgElement
        const Icon = ({ name, size = 24, className = "", strokeWidth = 2 }) => {
            const [iconHtml, setIconHtml] = useState("");
            
            useEffect(() => {
                const renderIcon = () => {
                    const lucideObj = window.lucide;
                    if (lucideObj && lucideObj.icons) {
                        const iconData = lucideObj.icons[name];
                        if (iconData) {
                            const [tagName, attributes, children] = iconData;
                            
                            const attrs = {
                                ...attributes,
                                width: size,
                                height: size,
                                'stroke-width': strokeWidth,
                                class: `lucide lucide-${name.toLowerCase()} ${className}`,
                                xmlns: "http://www.w3.org/2000/svg"
                            };

                            const attrString = Object.entries(attrs)
                                .map(([key, value]) => `${key}="${value}"`)
                                .join(' ');

                            const childrenString = children.map(([childTag, childAttrs]) => {
                                const childAttrStr = Object.entries(childAttrs)
                                    .map(([k, v]) => `${k}="${v}"`)
                                    .join(' ');
                                return `<${childTag} ${childAttrStr}></${childTag}>`;
                            }).join('');

                            setIconHtml(`<svg ${attrString}>${childrenString}</svg>`);
                        }
                    }
                };

                if (window.lucide) {
                    renderIcon();
                } else {
                    const timer = setTimeout(renderIcon, 100);
                    return () => clearTimeout(timer);
                }
            }, [name, size, className, strokeWidth]);

            return <span className="inline-flex items-center justify-center" dangerouslySetInnerHTML={{ __html: iconHtml }} />;
        };

        const SECTIONS = [
            {
                title: "Section A: Decision Pressure & Business Reality",
                questions: [
                    { id: 1, text: "Q1. Which business situations create the highest personal pressure for you today?", options: ["Large financial commitments (capex, guarantees)", "Managing cash flows and working capital", "Scaling operations without loss of control", "People and leadership decisions", "Dealing with banks, investors, or lenders", "Family or ownership-related matters", "Staying competitive in the market", "I feel comfortable handling most situations"], type: "multi" },
                    { id: 2, text: "Q2. When faced with an important business decision, what is your first instinct?", options: ["Trust my own judgment based on experience", "Discuss internally with my senior team", "Check financial implications carefully", "Seek perspective from someone experienced", "Delay decision until more clarity emerges"], type: "single" },
                    { id: 3, text: "Q3. How would you describe your current management structure?", options: ["Strong leadership team with clear accountability", "Capable operational team, strategic decisions stay with me", "Management exists but depends heavily on me", "Mostly promoter-driven", "Still evolving / not clearly defined"], type: "single" },
                    { id: 4, text: "Q4. Which statement best reflects your approach to delegation?", options: ["I delegate freely and review outcomes", "I delegate but stay closely involved", "I prefer to take final decisions myself", "I find delegation difficult in critical matters"], type: "single" },
                    { id: 5, text: "Q5. How confident are you in the quality of financial information you receive?", options: ["Very confident – timely and decision-oriented", "Generally reliable but not insightful", "Accurate but delayed", "Too technical, not decision-friendly", "I mostly rely on my own understanding"], type: "single" },
                    { id: 6, text: "Q6. Which of these statements resonates most with you?", options: ["Growth opportunities excite me more than risks worry me", "I balance growth and risk cautiously", "I worry more about downside than upside", "I avoid major risks unless absolutely necessary"], type: "single" },
                    { id: 7, text: "Q7. When things go wrong, what usually causes the most stress?", options: ["Financial strain or liquidity pressure", "Execution gaps in the organization", "People issues or leadership gaps", "External factors beyond control", "Decision-making uncertainty"], type: "single" },
                    { id: 8, text: "Q8. How often do you feel the need for a neutral, independent perspective before major decisions?", options: ["Very often", "Sometimes", "Rarely", "Almost never"], type: "single" }
                ]
            },
            {
                title: "Section B: Self-Discovery – Management & Decision Style",
                questions: [
                    { id: 9, text: "Q9. Which role do you play most often in your business?", options: ["Visionary & growth driver", "Financial controller & risk manager", "Operational problem solver", "Relationship builder", "All of the above"], type: "single" },
                    { id: 10, text: "Q10. How would you describe your decision-making speed?", options: ["Fast and intuitive", "Fast but data-backed", "Deliberate and cautious", "Slow due to multiple considerations"], type: "single" },
                    { id: 11, text: "Q11. What usually limits your ability to scale faster?", options: ["Capital availability", "Leadership bandwidth", "Systems and processes", "Market uncertainty", "My own comfort with risk"], type: "single" },
                    { id: 12, text: "Q12. When advisors or experts give you input, what do you value most?", options: ["Clear thinking, not jargon", "Experience with similar situations", "Ability to challenge my views", "Practical and implementable insights", "Confidentiality and trust"], type: "single" },
                    { id: 13, text: "Q13. How do you usually prepare for large financial or strategic decisions?", options: ["Detailed analysis and scenarios", "Discussions with trusted people", "Past experience and intuition", "Combination of all", "Often under time pressure"], type: "single" },
                    { id: 14, text: "Q14. How do you view control in your business?", options: ["Necessary to stay involved deeply", "Important but can be shared gradually", "Comfortable with professional management", "Still figuring this out"], type: "single" },
                    { id: 15, text: "Q15. Which of these best reflects your long-term concern?", options: ["Sustained growth", "Financial stability", "Smooth succession", "Preserving control and values", "Balancing business and personal life"], type: "single" },
                    { id: 16, text: "Q16. Open Reflection (Optional): What is one decision or challenge you wish you had handled differently in the past?", options: [], type: "text" }
                ]
            }
        ];

        function App() {
            const [step, setStep] = useState('welcome');
            const [currentSectionIndex, setCurrentSectionIndex] = useState(0);
            const [answers, setAnswers] = useState({});
            const [loading, setLoading] = useState(false);
            const [feedback, setFeedback] = useState('');
            const [error, setError] = useState('');
            const [copied, setCopied] = useState(false);
            const [showShareModal, setShowShareModal] = useState(false);
            const [recipientNumber, setRecipientNumber] = useState('');

            const handleSingleSelect = (qId, value) => {
                setAnswers(prev => ({ ...prev, [qId]: value }));
            };

            const handleMultiSelect = (qId, value) => {
                const current = answers[qId] || [];
                const updated = current.includes(value) 
                    ? current.filter(item => item !== value)
                    : [...current, value];
                setAnswers(prev => ({ ...prev, [qId]: updated }));
            };

            const copyToClipboard = () => {
                const textArea = document.createElement("textarea");
                textArea.value = feedback;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('Copy failed', err);
                }
                document.body.removeChild(textArea);
            };

            const logShareAction = async (targetPhone) => {
                if (SCRIPT_URL && SCRIPT_URL.includes("/exec")) {
                    try {
                        const payload = {
                            timestamp: new Date().toLocaleString(),
                            type: "WhatsApp Share Event",
                            recipient: targetPhone || "Not specified",
                            summary: feedback.substring(0, 100) + "..."
                        };
                        fetch(SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                    } catch (e) { console.error(e); }
                }
            };

            const handleWhatsAppShare = () => {
                logShareAction(recipientNumber);
                const toolLink = APP_URL || window.location.origin;
                const message = `I just completed my Promoter Self-Discovery diagnostic. Here is my decision snapshot: \n\n${feedback}\n\nTry the tool yourself at: ${toolLink}`;
                const encodedText = encodeURIComponent(message);
                const base = recipientNumber 
                    ? `https://api.whatsapp.com/send?phone=${recipientNumber.replace(/\D/g, '')}&text=` 
                    : `https://wa.me/?text=`;
                window.open(base + encodedText, '_blank');
                setShowShareModal(false);
            };

            const submitDiagnosis = async () => {
                setLoading(true);
                setError('');
                try {
                    if (SCRIPT_URL) {
                        const sheetPayload = { timestamp: new Date().toLocaleString(), type: "Diagnosis" };
                        Object.keys(answers).forEach(k => { sheetPayload[`Q${k}`] = answers[k]; });
                        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(sheetPayload) });
                    }

                    const prompt = `Based on these diagnostic answers: ${JSON.stringify(answers)}. Generate a "Promoter Decision Style Snapshot". Format as plain text with headers and bullets. NO markdown.`;
                    
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                    });
                    
                    const result = await response.json();
                    setFeedback(result.candidates?.[0]?.content?.parts?.[0]?.text || "Error generating results.");
                    setStep('result');
                } catch (err) {
                    setError("Analysis failed. Please try again.");
                } finally {
                    setLoading(false);
                }
            };

            const currentSection = SECTIONS[currentSectionIndex];

            return (
                <div className="min-h-screen bg-[#F8FAFC] flex flex-col items-center p-4 sm:p-8 font-sans text-slate-900">
                    <div className="max-w-2xl w-full bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden mt-4 sm:mt-10 relative">
                        
                        {step === 'quiz' && (
                            <div className="h-1.5 w-full bg-slate-100">
                                <div className="h-full bg-indigo-600 transition-all duration-500" style={{ width: `${((currentSectionIndex + 1) / SECTIONS.length) * 100}%` }} />
                            </div>
                        )}

                        <div className="p-6 sm:p-10 text-center">
                            {step === 'welcome' && (
                                <div className="space-y-8 animate-in">
                                    <div className="flex flex-col items-center space-y-4">
                                        <div className="p-4 bg-indigo-50 rounded-2xl text-indigo-600">
                                            <Icon name="BarChart3" size={48} strokeWidth={1.5} />
                                        </div>
                                        <h1 className="text-3xl font-extrabold tracking-tight text-slate-900">Promoter Self-Discovery</h1>
                                        <p className="text-slate-500">Reflect on your management and decision style.</p>
                                    </div>
                                    <button onClick={() => setStep('quiz')} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-5 rounded-xl shadow-lg flex items-center justify-center gap-2">
                                        Begin Diagnostic <Icon name="ChevronRight" />
                                    </button>
                                </div>
                            )}

                            {step === 'quiz' && (
                                <div className="space-y-10 animate-in text-left">
                                    <h2 className="text-2xl font-bold text-slate-800">{currentSection.title}</h2>
                                    {currentSection.questions.map((q) => (
                                        <div key={q.id} className="space-y-4">
                                            <p className="text-lg font-semibold">{q.text}</p>
                                            {q.type === 'text' ? (
                                                <textarea className="w-full p-4 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 min-h-[120px]" placeholder="Type here..." onChange={(e) => handleSingleSelect(q.id, e.target.value)} />
                                            ) : (
                                                <div className="grid gap-2">
                                                    {q.options.map((opt) => (
                                                        <button key={opt} onClick={() => q.type === 'multi' ? handleMultiSelect(q.id, opt) : handleSingleSelect(q.id, opt)} className={`text-left p-4 rounded-xl border-2 transition-all ${ (q.type === 'multi' ? (answers[q.id] || []).includes(opt) : answers[q.id] === opt) ? 'border-indigo-600 bg-indigo-50 text-indigo-700' : 'border-slate-100 bg-slate-50'}`}>
                                                            {opt}
                                                        </button>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                    <div className="pt-8 border-t flex justify-between">
                                        {currentSectionIndex > 0 && <button onClick={() => setCurrentSectionIndex(0)} className="text-slate-400">Back</button>}
                                        <button onClick={() => currentSectionIndex === 0 ? setCurrentSectionIndex(1) : submitDiagnosis()} className="ml-auto bg-indigo-600 text-white px-10 py-4 rounded-xl font-bold">
                                            {loading ? "Analyzing..." : (currentSectionIndex === 0 ? "Next" : "Get Snapshot")}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {step === 'result' && (
                                <div className="space-y-6 animate-in">
                                    <h2 className="text-2xl font-bold">Your Decision Snapshot</h2>
                                    <div className="bg-[#1E293B] text-slate-100 p-8 rounded-2xl text-left whitespace-pre-wrap font-mono text-sm max-h-[400px] overflow-y-auto custom-scrollbar">
                                        {feedback}
                                    </div>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <button onClick={() => setShowShareModal(true)} className="bg-[#25D366] text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2">
                                            <Icon name="Share2" /> Share via WhatsApp
                                        </button>
                                        <button onClick={copyToClipboard} className="bg-slate-200 text-slate-700 font-bold py-4 rounded-xl flex items-center justify-center gap-2">
                                            <Icon name={copied ? "Check" : "Copy"} /> {copied ? "Copied!" : "Copy Snapshot"}
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {showShareModal && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white rounded-2xl w-full max-w-sm p-8 shadow-2xl">
                                <h3 className="text-xl font-bold mb-4">Share with...</h3>
                                <input type="tel" placeholder="Recipient's Mobile No." value={recipientNumber} onChange={(e) => setRecipientNumber(e.target.value)} className="w-full p-4 bg-slate-50 border rounded-xl mb-4" />
                                <button onClick={handleWhatsAppShare} className="w-full bg-[#25D366] text-white font-bold py-4 rounded-xl">Continue to WhatsApp</button>
                                <button onClick={() => setShowShareModal(false)} className="w-full text-slate-400 mt-4">Cancel</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
